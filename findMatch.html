<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Colorlib Templates">
    <meta name="author" content="Colorlib">
    <meta name="keywords" content="Colorlib Templates">

    <!-- Title Page-->
    <title>üíãBoilerMatchüíè</title>

    <!-- Icons font CSS-->
    <link href="vendor/mdi-font/css/material-design-iconic-font.min.css" rel="stylesheet" media="all">
    <link href="vendor/font-awesome-4.7/css/font-awesome.min.css" rel="stylesheet" media="all">
    <!-- Font special for pages-->
    <link href="https://fonts.googleapis.com/css?family=Poppins:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">

    <!-- Vendor CSS-->
    <link href="vendor/select2/select2.min.css" rel="stylesheet" media="all">
    <link href="vendor/datepicker/daterangepicker.css" rel="stylesheet" media="all">

    <!-- Main CSS-->
    <link href="css/main.css" rel="stylesheet" media="all">

    <!-- PyScript Stuff-->
    <link rel="stylesheet" href="https://pyscript.net/alpha/pyscript.css" />
    <script defer src="https://pyscript.net/alpha/pyscript.js"></script>
    <py-env>
        - pandas
        - scikit-learn
        - firebase_admin
    </py-env>
</head>

<body>
    <div class="page-wrapper bg-gra-02 p-t-130 p-b-100 font-poppins">
        <div class="wrapper wrapper--w680">
            <form id="resultForm">
                <div class="row row-space">
                    <div class="col-2">
                        <div class="input-group">
                            <label class="label" id="result_puid"><b>ENTER PUID</b></label>
                            <input class="input--style-4" type="text" name="name" id="puidResult">
                        </div>
                    </div>
                    <button class="btn btn--radius-2 btn--blue" type="submit" id="results">GET RESULTS</button>
                </div>
            </form>
        </div>
        <py-script>
import math
import pandas as pd
from sklearn.preprocessing import LabelEncoder
import firebase_admin
from firebase_admin import credentials, firestore

cred = credentials.Certificate("pythonCredentials.json")
firebase_admin.initialize_app(cred)

db = firebase_admin.firestore.client()

users = list(db.collection(u'formData').stream())

docs = db.collection(u'formData').stream()

frames = []

for doc in docs:

    userResponses = doc.to_dict()

    frames.append(pd.DataFrame(userResponses, index=[0,]))



finalized_dataframe = pd.concat(frames)

name_column = finalized_dataframe.pop('name')
major_column = finalized_dataframe.pop('major')
number_column = finalized_dataframe.pop('number')
gender_column = finalized_dataframe.pop('gender')
year_column = finalized_dataframe.pop('year')
puid_column = finalized_dataframe.pop('puid')

finalized_dataframe.insert(0, 'Gender', gender_column)
finalized_dataframe.insert(0, 'Major', major_column)
finalized_dataframe.insert(0, 'Year', year_column)
finalized_dataframe.insert(0, 'Phone Number', number_column)
finalized_dataframe.insert(0, 'PUID', puid_column)
finalized_dataframe.insert(0, 'Name', name_column)


total_data = []

df_input = finalized_dataframe

names = df_input.iloc[: , 0:2] # Get a dataframe of all the names


person_info = df_input.iloc[: , 0:6]  # Get a dataframe of person information

preference_info_temp = df_input.iloc[:, 36:37] # Get a dataframe of person preference info

response_data_temp = df_input.iloc[: , 6:36] # Get a dataframe of all the responses

response_frames = [names, response_data_temp]
preference_frames = [names, preference_info_temp]

response_data = pd.concat(response_frames, axis=1) # Concating the names and response dataframes together
preference_data = pd.concat(preference_frames, axis=1) # Concating the names and preference dataframes together

studentIdNumber = 1234567 #Replace with user input


student_response = response_data[response_data['PUID'] == str(studentIdNumber)]
student_preference = preference_data[preference_data['PUID'] == str(studentIdNumber)]

gender_preference = int(student_preference['interested_gender'])

# print(student_response) #Use to iterate through student responses


person_scores = []


for row in response_data.iterrows(): # Iterating through the rows

    currentId = row[1][1]


    if studentIdNumber!= currentId: # Checking to make sure not the same person

        currentName = row[1][0]


        score = 0 # Need to iterate through 2-32 indexes

        for index in range(2, 32):

            student_choice = student_response.loc[0][index]
            current_choice = row[1][index]

            student_choice = int(student_choice)
            current_choice = int(current_choice)

            score += pow( (current_choice - student_choice), 2)

            percentage = 1 / ( 1 + pow( math.e, (0.045 * ( score - 67.5 ) ) ) )

            percentage = (percentage) * 100

            percentage = round(percentage, 2)

            percentage = str(percentage)


        person_scores.append([currentName, currentId, percentage])



person_scores = sorted(person_scores, key = lambda x: x[2], reverse=False)

for index in range(0, len(person_scores)):

    if person_scores[index][1] == str(studentIdNumber):

        person_scores.pop(index)

    break;


final_results = []

# ReType to get id number curr3ent person gender intermeadgte and all values

for index in range(0, len(person_scores)): #Note for personal information to check, 0-M, 1-F, 2-NB

    id_number = person_scores[index][1]

    current_person = person_info[person_info['PUID'] == str(id_number)]

    current_gender = int(current_person['Gender'])

    intermediate = person_scores[index]


    if gender_preference == 0:

       if current_gender == 0:

           intermediate.append('Male')

           final_results.append(intermediate)



    elif gender_preference == 1:

        if current_gender == 1:

            intermediate.append('Female')

            final_results.append(intermediate)



    elif gender_preference == 2:

        if current_gender == 2:

            intermediate.append('Non-Binary')

            final_results.append(intermediate)



    elif gender_preference == 3:

        if current_gender == 0:

            intermediate.append('Male')

            final_results.append(intermediate)

        elif current_gender == 1:

            intermediate.append('Female')

            final_results.append(intermediate)



    elif gender_preference == 4:

        if current_gender == 0:

            intermediate.append('Male')

            final_results.append(intermediate)

        elif current_gender == 2:

            intermediate.append('Non-Binary')

            final_results.append(intermediate)



    elif gender_preference == 5:

        if current_gender == 1:

            intermediate.append('Female')

            final_results.append(intermediate)

        elif current_gender == 2:

            intermediate.append('Non-Binary')

            final_results.append(intermediate)

    else:

        if current_gender == 0:

            intermediate.append('Male')

            final_results.append(intermediate)

        elif current_gender == 1:

            intermediate.append('Female')

            final_results.append(intermediate)

        else:

            intermediate.append('Non-Binary')

            final_results.append(intermediate)



print(final_results)
        </py-script>
    </div>

    <!-- Jquery JS-->
    <script src="vendor/jquery/jquery.min.js"></script>
    <!-- Vendor JS-->
    <script src="vendor/select2/select2.min.js"></script>
    <script src="vendor/datepicker/moment.min.js"></script>
    <script src="vendor/datepicker/daterangepicker.js"></script>

    <!-- Main JS-->
    <script src="js/global.js"></script>

    <script>
        const results = document.getElementById("resultForm");
        let puid = null
        results.addEventListener('submit', async(e) => {
            e && e.preventDefault();
            puid = document.getElementById('puidResult').value;
            alert("WOW");
        })
    </script>

</body>
</html>